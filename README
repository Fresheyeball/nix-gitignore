- filter-source-helper.nix
    This implements primitive a gitignore filter for filterSource via
    translation to regexes. There are cases when the ordering of patterns
    matters somewhat, unlike with gitignore.

    NB: This is untested and experimental! How well it works is currently
    anyone's guess.

% ls
  build-tree  filter-source-helper.nix  README

% ./build-tree; find test-tree
    test-tree
    test-tree/1-simple
    test-tree/1-simple/1
    test-tree/1-simple/2
    test-tree/1-simple/3
    test-tree/1-simple/4
    test-tree/1-simple/5
    test-tree/2-negation
    test-tree/2-negation/10
    test-tree/2-negation/20
    test-tree/2-negation/30
    test-tree/2-negation/40
    test-tree/2-negation/50
    test-tree/3-wildcards
    test-tree/3-wildcards/bar.html
    test-tree/3-wildcards/foo.html
    test-tree/3-wildcards/html
    test-tree/3-wildcards/html/bar.html
    test-tree/3-wildcards/html/foo.html
    test-tree/4-escapes
    test-tree/4-escapes/*.html
    test-tree/4-escapes/o__ther.html
    test-tree/4-escapes/o_ther.html
    test-tree/4-escapes/o?ther.html
    test-tree/4-escapes/other.html
    test-tree/4-escapes/other.html$
    test-tree/4-escapes/other.html$$

# The patterns used:
    1-simple/1
    /1-simple/2
    ^1-simple/3

    !2-*/1?
    !2-*/30
    !/40
    !50
    2-*/*

    3-*/*foo.html
    3-*/**/bar.html

    4-*/\*.html
    4-*/o??ther.html
    4-*/o\?ther.html
    4-*/other.html$

% nix eval '(import ./examples.nix)' --json | jq -r '.[]' | \
  xargs -rL1 sh -c 'find "$@" | sed "s@/.\{32\}-@/...-@" | sort' ''
    # patterns
    /nix/store/...-test-tree
    /nix/store/...-test-tree/1-simple
    /nix/store/...-test-tree/1-simple/1
    /nix/store/...-test-tree/1-simple/3
    /nix/store/...-test-tree/1-simple/4
    /nix/store/...-test-tree/1-simple/5
    /nix/store/...-test-tree/2-negation
    /nix/store/...-test-tree/2-negation/30
    /nix/store/...-test-tree/3-wildcards
    /nix/store/...-test-tree/3-wildcards/bar.html
    /nix/store/...-test-tree/3-wildcards/foo.html
    /nix/store/...-test-tree/3-wildcards/html
    /nix/store/...-test-tree/3-wildcards/html/bar.html
    /nix/store/...-test-tree/3-wildcards/html/foo.html
    /nix/store/...-test-tree/4-escapes
    /nix/store/...-test-tree/4-escapes/*.html
    /nix/store/...-test-tree/4-escapes/o__ther.html
    /nix/store/...-test-tree/4-escapes/o_ther.html
    /nix/store/...-test-tree/4-escapes/o?ther.html
    /nix/store/...-test-tree/4-escapes/other.html
    /nix/store/...-test-tree/4-escapes/other.html$
    /nix/store/...-test-tree/4-escapes/other.html$$

    # git patterns
    /nix/store/...-test-tree
    /nix/store/...-test-tree/1-simple
    /nix/store/...-test-tree/1-simple/3
    /nix/store/...-test-tree/1-simple/4
    /nix/store/...-test-tree/1-simple/5
    /nix/store/...-test-tree/2-negation
    /nix/store/...-test-tree/2-negation/10
    /nix/store/...-test-tree/2-negation/30
    /nix/store/...-test-tree/2-negation/50
    /nix/store/...-test-tree/3-wildcards
    /nix/store/...-test-tree/3-wildcards/html
    /nix/store/...-test-tree/3-wildcards/html/foo.html
    /nix/store/...-test-tree/4-escapes
    /nix/store/...-test-tree/4-escapes/o_ther.html
    /nix/store/...-test-tree/4-escapes/other.html
    /nix/store/...-test-tree/4-escapes/other.html$$
